---
title: etcd做配置中心的使用
date: 2018-04-29 07:57:10
tags:
---

#### 存在的问题
- 配置文件的作用
配置文件是项目中不可缺少的一部分，它的作用主要用来，灵活配置项目的一些通用配置项。方便部署时切换环境，不用动到代码层面。

- 项目做法
在部署时配置一个环境变量
```
export config_path = "/home/dev/config/config.yaml"
```
在项目中通过load加载该文件，同时读取代码中的基础配置文件，将二者获取的内容进行合并，作为最终项目需要的配置项，供项目中其它代码使用。

#### devops环境上的存在的痛点
将所负责的项目迁到devops，配置这块还是按照现在的做法部署，将配置文件随代码库一起提交，在容器中设置环境变量。这样的做法有个很大的问题，就是测试环境和开发环境的切换，需要每次都修改配置代码，这样很容易出问题。

#### 解决的方式
etcd是go语言开发的一个分布式key－value数据库，主要用来做服务发现和配置中心等。在devops环境中，通过使用该组件，我们可以轻松的解决了以上的问题。

-  搭建ectd容器
-  将部署容器的环境变量设置为etcd的获取key的接口http://host:2379/v2/keys/config
-  通过etcd接口向etcd中设置值
此处，需要注意的是，向配置文件内容base64后存入etcd中，在代码中，需要将获取的值base64做转码

#### 存在的问题
- 存在着重大的安全问题，使用的原生的ectd的接口，没有安全验证，缺乏安全性
- 通过命令向配置中心添加配置文件，同样不安全，另外这种设定的方式也很不直观，不小心配置错了，拍错难度有些大

